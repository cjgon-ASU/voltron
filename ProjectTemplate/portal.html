<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title></title>
	<!--DO NOT FORGET THIS SCRIPT TAG SO YOU CAN USE JQUERY!!!!!-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<!--YOUR OWN JAVASCRIPT CAN GO RIGHT HERE-->
	<script type="text/javascript">
		function TestButtonHandler() {
			var webMethod = "ProjectServices.asmx/TestConnection";
			var parameters = "{}";

			//jQuery ajax method
			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
					alert(responseFromServer);
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
		}

		function LogOff() {

			var webMethod = "ProjectServices.asmx/LogOff"
			var parameters = "{}";

			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
					if (responseFromServer == true) {
						window.location.href = "index.html";
					}
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
		}


        function ClockIn() {

			var webMethod = "ProjectServices.asmx/ClockIn"
			var parameters = "{}";

			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
                    if (responseFromServer == true) {
						document.getElementById("clockInBtn").style.display = "none";
				        document.getElementById("logOffBtn").style.display = "none";
                        document.getElementById("clockOutBtn").style.display = "inline";
                        document.getElementById("clockedinconfirm").style.display = "inline";
					}
					else {
						alert("Unable to clock in")
					}
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
        }

        function ClockOut() {

			var webMethod = "ProjectServices.asmx/ClockOut"
			var parameters = "";

			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
                    if (responseFromServer == true) {
						document.getElementById("clockInBtn").style.display = "inline";
				        document.getElementById("logOffBtn").style.display = "inline";
                        document.getElementById("clockOutBtn").style.display = "none";
						document.getElementById("clockedinconfirm").style.display = "none";
						document.getElementById("emojiFeedbackModal").style.display = "block";
					}
					else {
						alert("Unable to Clock out")
					}
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
		}

		function GetClockedInUsers() {

			var webMethod = "ProjectServices.asmx/GetClockedInUsers"
			var parameters = "{}";

			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var users = msg.d;
                    var wrapper = document.getElementById("userTableWrapper");
					var tbody = document.getElementById("userTableBody");
					tbody.innerHTML = "";

					if (users.length === 0) {
						tbody.innerHTML = "<tr><td colspan='5'>No users clocked in.</td></tr>";
                        wrapper.style.display = "block";
						return;
					}

					for (var i = 0; i < users.length; i++) {
						var user = users[i];
						var row = "<tr>" +
							"<td>" + user.empid + "</td>" +
							"<td>" + user.username + "</td>" +
							"<td>" + user.fname + "</td>" +
							"<td>" + user.lname + "</td>" +
							"<td>" + user.department + "</td>" +
							"</tr>";
						tbody.innerHTML += row;
					}

                    wrapper.style.display = "block";

				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
		}

		function SubmitEmojiFeedback(score) {
            var qid = "";
            var empid = "";
            var dept = "";
            var cat = "Stress";
            var feedback = "";

			var webMethod = "ProjectServices.asmx/SubmitFeedback";
			var parameters = JSON.stringify({
				qid: encodeURIComponent(qid),
                empid: encodeURIComponent(empid),
                dept: encodeURIComponent(dept),
                cat: encodeURIComponent(cat),
                score: encodeURIComponent(score),
                feedback: encodeURIComponent(feedback)
			})

            var qid = "";
            var empid = "";
            var dept = "";
            var cat = "Stress";
            var feedback = "";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        alert("Feedback Recieved. Thank you!");
                    } else {
                        alert("Feedback submission failed.");
                    }
                },
                error: function (e) {
                    alert("Could not submit feedback due to server error.");
				}
            });
		}

        document.addEventListener("DOMContentLoaded", function () {
			document.querySelectorAll('.score-btn').forEach(button => {
				button.addEventListener('click', function () {
					const score = this.getAttribute('data-score');
					SubmitEmojiFeedback(score);	
				});
			});

			document.getElementById("closeModal").addEventListener("click", function () {
				document.getElementById("emojiFeedbackModal").style.display = "none";
			});
		});
	</script>
	<!--END OF YOUR OWN JAVASCRIPT-->

	<!--AND YOUR OWN CSS CAN GO HERE AS WELL-->
	<style>

	</style>
	<!--END OF YOUR OWN CSS-->
</head >
<body>
	<button id="logOffBtn" onclick="LogOff();">Log Off</button>
	<button id="clockInBtn" onclick="ClockIn();">Clock In</button>
	<button id="clockOutBtn" onclick="ClockOut();" style="display: none;">Clock Out</button>
	<p id="clockedinconfirm" style="display:none;">You are clocked in!</p>

	<button id="getClockedInUsersBtn" onclick="GetClockedInUsers();">Get Clocked In Users</button>


	<div id="userTableWrapper" style="display: none;">
		<h3>Clocked In Users</h3>
		<table id="userTable" border="1">
			<thead>
				<tr>
					<th>EmpID</th>
					<th>Username</th>
					<th>First Name</th>
					<th>Last Name</th>
					<th>Department</th>
				</tr>
			</thead>
			<tbody id="userTableBody">
			</tbody>
		</table>
	</div>

	<div id="emojiFeedbackModal" class="modal" style="display: none;">
		<div class="modal-content">
			<button class="close" id="closeModal">X</button>
			<h2>Rate Your Shift</h2>

			<div id="scoreButtons">
				<button class="score-btn" data-score="0" id="scorebutton1">üòÄ</button>
				<button class="score-btn" data-score="3" id="scorebutton2">üòê</button>
				<button class="score-btn" data-score="5" id="scorebutton3">üôÅ</button>
				<button class="score-btn" data-score="8" id="scorebutton4">‚òπÔ∏è</button>
				<button class="score-btn" data-score="10"id="scorebutton5">üò≠</button>
			</div>
		</div>
	</div>
</body>
</html >