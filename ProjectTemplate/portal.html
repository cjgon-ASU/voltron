<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title></title>
	<!--DO NOT FORGET THIS SCRIPT TAG SO YOU CAN USE JQUERY!!!!!-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<!--YOUR OWN JAVASCRIPT CAN GO RIGHT HERE-->
	<script type="text/javascript">
		function TestButtonHandler() {
			var webMethod = "ProjectServices.asmx/TestConnection";
			var parameters = "{}";

			//jQuery ajax method
			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
					alert(responseFromServer);
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
		}

        function AdminCheck() {
            var webMethod = "ProjectServices.asmx/AdminCheck"
            var parameters = ""

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        console.log("User is logged in as Admin.");
                        alert("User is logged on as Admin.")
                    }
                    else alert("User does not have Admin privileges.");
                },
                error: function (e) {
                    alert("Unable to check admin status.")
                }
            });
        }


		function LogOff() {

			var webMethod = "ProjectServices.asmx/LogOff"
			var parameters = "{}";

			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
					if (responseFromServer == true) {
						window.location.href = "index.html";
					}
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
		}


        function ClockIn() {

			var webMethod = "ProjectServices.asmx/ClockIn"
			var parameters = "{}";

			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
                    if (responseFromServer == true) {
						document.getElementById("clockInBtn").style.display = "none";
				        document.getElementById("logOffBtn").style.display = "none";
                        document.getElementById("clockOutBtn").style.display = "inline";
                        alert("You are clocked in.")
					}
					else {
						alert("Unable to clock in")
					}
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
        }

        function ClockOut() {

			var webMethod = "ProjectServices.asmx/ClockOut"
			var parameters = "";

			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
                    if (responseFromServer == true) {
						document.getElementById("clockInBtn").style.display = "inline";
				        document.getElementById("logOffBtn").style.display = "inline";
                        document.getElementById("clockOutBtn").style.display = "none";
						alert("You have clocked out, please leave an Emoji, or some feedback to let us know how your shift went.")
						document.getElementById("emojiFeedbackModal").style.display = "block";
					}
					else {
						alert("Unable to Clock out")
					}
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
		}

        function GetClockedInUsers() {

            var webMethod = "ProjectServices.asmx/GetClockedInUsers"
            var parameters = "{}";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    var users = msg.d;
                    var wrapper = document.getElementById("userTableWrapper");
                    var tbody = document.getElementById("userTableBody");
                    tbody.innerHTML = "";

                    if (users.length === 0) {
                        alert("You are not an admin or no users are currently clocked in.");
                        $("#userTableWrapper").hide();
                        return;
                    }

                    for (var i = 0; i < users.length; i++) {
                        var user = users[i];
                        var row = "<tr>" +
                            "<td>" + user.empid + "</td>" +
                            "<td>" + user.username + "</td>" +
                            "<td>" + user.fname + "</td>" +
                            "<td>" + user.lname + "</td>" +
                            "<td>" + user.department + "</td>" +
                            "</tr>";
                        tbody.innerHTML += row;
                    }

                    wrapper.style.display = "block";

                },
                error: function (e) {
                    alert("this code will only execute if javascript is unable to access the webservice");
                }
            });
		}

		function SubmitEmojiFeedback(score) {
            var qid = "";
            var empid = "";
            var dept = "";
            var cat = "Stress";
            var feedback = "";

			var webMethod = "ProjectServices.asmx/SubmitFeedback";
			var parameters = JSON.stringify({
				qid: encodeURIComponent(qid),
                empid: encodeURIComponent(empid),
                dept: encodeURIComponent(dept),
                cat: encodeURIComponent(cat),
                score: encodeURIComponent(score),
                feedback: encodeURIComponent(feedback)
			})

            var qid = "";
            var empid = "";
            var dept = "";
            var cat = "Stress";
            var feedback = "";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        alert("Feedback Recieved. Thank you!");
                    } else {
                        alert("Feedback submission failed.");
                    }
                },
                error: function (e) {
                    alert("Could not submit feedback due to server error.");
				}
            });
		}

        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll('.score-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const score = this.getAttribute('data-score');
                    SubmitEmojiFeedback(score);
                });
            });

            document.getElementById("closeModal").addEventListener("click", function () {
                document.getElementById("emojiFeedbackModal").style.display = "none";
            });

            document.getElementById("closeAnonModal").addEventListener("click", function () {
                document.getElementById("submitAnonymousFeedback").style.display = "none";
            });

            document.getElementById("closeClockedInUsersModal").addEventListener("click", function () {
                document.getElementById("userTableWrapper").style.display = "none";
            });

            document.getElementById("closeGetUsersModal").addEventListener("click", function () {
                document.getElementById("getUsersTableWrapper").style.display = "none";
            });

        });

		function openAnonFeedback() {
			document.getElementById("submitAnonymousFeedback").style.display = "block";
		}

		document.getElementById("closeAnonModal").onclick = function () {
			document.getElementById("submitAnonymousFeedback").style.display = "none";
		}

        function submitAnonFeedback() {
            var feedback = document.getElementById("feedbackText").value.trim();

            if (!feedback) {
                alert("Please enter your feedback before submitting.");
                return;
            }

            var webMethod = "ProjectServices.asmx/SubmitFeedback";
            var parameters = JSON.stringify({
                qid: "",
                empid: "",
                dept: "",
                cat: "Anonymous",
                score: "",
                feedback: encodeURIComponent(feedback)
            });

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        alert("Anonymous feedback submitted. Thank you!");
                        document.getElementById("feedbackText").value = "";
                        document.getElementById("submitAnonymousFeedback").style.display = "none";
                    } else {
                        alert("Anonymous feedback submission failed.");
                    }
                },
                error: function () {
                    alert("Server error while submitting feedback.");
                }
            });
        }
	</script>
	<!--END OF YOUR OWN JAVASCRIPT-->

	<!--AND YOUR OWN CSS CAN GO HERE AS WELL-->
	<style>
        * {
            font-family: 'Helvetica Neue LT Std';
            font-size: 16px;
        }

        button {
            background-color: #555555;
            font-family: 'Helvetica Neue LT Std';
            border: none;
            color: white;
            padding: 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border-radius: 4px;
            letter-spacing: 1px;
            transition-duration: 0.1s;
        }

        button:hover {
            background-color: white;
            color: #555555;
            border: 1px solid #555555;
        }
	</style>
	<!--END OF YOUR OWN CSS-->
</head >
<body>
    <button id="logOffBtn" onclick="LogOff();">Log Off</button>
    <button id="clockInBtn" onclick="ClockIn();">Clock In</button>
    <button id="clockOutBtn" onclick="ClockOut();" style="display: none;">Clock Out</button>
    <p id="clockedinconfirm" style="display:none;">You are clocked in!</p>


    

    <div id="emojiFeedbackModal" class="modal" style="display: none">
        <div class="modal-content">
            <button class="close" id="closeModal" style="background-color: #f44336; font-size: 8; padding: 10px;">X</button>
            <h2>Rate Your Shift</h2>

            <div id="scoreButtons">
                <button class="score-btn" data-score="0" id="scorebutton1" style="background-color: #0000FF;">😀</button>
                <button class="score-btn" data-score="3" id="scorebutton2" style="background-color: #00FF00;">😐</button>
                <button class="score-btn" data-score="5" id="scorebutton3" style="background-color: #808080;">🙁</button>
                <button class="score-btn" data-score="8" id="scorebutton4" style="background-color: #FFFF00;">☹️</button>
                <button class="score-btn" data-score="10" id="scorebutton5" style="background-color: #FF0000; ">😭</button>
            </div>
            <div id="feedbackSavedMsg" style="color: green; margin-top: 10px; display: none;">
                Feedback saved!
            </div>
        </div>
    </div>

    <button onclick="openAnonFeedback()">Submit Anonymous Feedback</button>

    <div id="submitAnonymousFeedback" class="modal" style="display: none;">
        <div class="modal-content">
            <button class="close" id="closeAnonModal" style="background-color: #f44336; font-size: 8; padding: 10px;">X</button>
            <h2>Anonymous Feedback</h2>

            <div id="anonymousFeedback">
                <textarea id="feedbackText" placeholder="Write your feedback here!"></textarea>
                <button onclick="submitAnonFeedback()">Submit</button>
            </div>
        </div>
    </div>

    <div id="Admin Tools">
        <h1 style="font-size: 20px; text-decoration: underline;">Admin Tools</h1>

        <h1 style="font-size: 16px;">General</h1>
        <button id="getClockedInUsersBtn" onclick="GetClockedInUsers();">Get Clocked In Users</button>
        <button id="adminCheck" onclick="AdminCheck()">Admin Check</button>


        <div id="userTableWrapper" style="display: none;">
            <button class="close" id="closeClockedInUsersModal" style="background-color: #f44336; font-size: 8; padding: 10px;">X</button>
            <h3>Clocked In Users</h3>
            <table id="userTable" border="1">
                <thead>
                    <tr>
                        <th>EmpID</th>
                        <th>Username</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Department</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                </tbody>
            </table>
        </div>


        <h1 style="font-size: 16px;">User Management</h1>
        <button id="getUsers" onclick="GetUsers();">Get Users</button>
        <button id="addUsers" onclick="AddUsers();">Add Users</button>
        <button id="removeUsers" onclick="RemoveUsers();">Remove Users</button>
        <button id="editUsers" onclick="UpdateUsers();">Update Users</button>

    </div>

    <div id="getUsersTableWrapper" class="modal" style="display: none;">
        <button class="close" id="closeGetUsersModal" style="background-color: #f44336; font-size: 8; padding: 10px;">X</button>
        <h3>Clocked In Users</h3>
        <table id="userTable" border="1">
            <thead>
                <tr>
                    <th>EmpID</th>
                    <th>Username</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Department</th>
                </tr>
            </thead>
            <tbody id="userTableBody">
            </tbody>
        </table>
    </div>


</body>
</html >