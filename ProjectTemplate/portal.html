<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title></title>
	<!--DO NOT FORGET THIS SCRIPT TAG SO YOU CAN USE JQUERY!!!!!-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<!--YOUR OWN JAVASCRIPT CAN GO RIGHT HERE-->
	<script type="text/javascript">
		function TestButtonHandler() {
			var webMethod = "ProjectServices.asmx/TestConnection";
			var parameters = "{}";

			//jQuery ajax method
			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
					alert(responseFromServer);
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
		}

        function AdminCheck() {
            var webMethod = "ProjectServices.asmx/AdminCheck"
            var parameters = ""

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        console.log("User is logged in as Admin.");
                        alert("User is logged on as Admin.")
                    }
                    else alert("User does not have Admin privileges.");
                },
                error: function (e) {
                    alert("Unable to check admin status.")
                }
            });
        }


		function LogOff() {

			var webMethod = "ProjectServices.asmx/LogOff"
			var parameters = "{}";

			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
					if (responseFromServer == true) {
						window.location.href = "index.html";
					}
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
		}


        function ClockIn() {

			var webMethod = "ProjectServices.asmx/ClockIn"
			var parameters = "{}";

			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
                    if (responseFromServer == true) {
						document.getElementById("clockInBtn").style.display = "none";
				        document.getElementById("logOffBtn").style.display = "none";
                        document.getElementById("clockOutBtn").style.display = "inline";
                        alert("You are clocked in.")
					}
					else {
						alert("Unable to clock in")
					}
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
        }

        function ClockOut() {

			var webMethod = "ProjectServices.asmx/ClockOut"
			var parameters = "";

			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
                    if (responseFromServer == true) {
						document.getElementById("clockInBtn").style.display = "inline";
				        document.getElementById("logOffBtn").style.display = "inline";
                        document.getElementById("clockOutBtn").style.display = "none";
						alert("You have clocked out, please leave an Emoji, or some feedback to let us know how your shift went.")
						document.getElementById("emojiFeedbackModal").style.display = "block";
					}
					else {
						alert("Unable to Clock out")
					}
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
		}

        function GetClockedInUsers() {

            var webMethod = "ProjectServices.asmx/GetClockedInUsers"
            var parameters = "{}";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    var users = msg.d;
                    var wrapper = document.getElementById("userTableWrapper");
                    var tbody = document.getElementById("userTableBody");
                    tbody.innerHTML = "";

                    if (users.length === 0) {
                        alert("You are not an admin or no users are currently clocked in.");
                        $("#userTableWrapper").hide();
                        return;
                    }

                    for (var i = 0; i < users.length; i++) {
                        var user = users[i];
                        var row = "<tr>" +
                            "<td>" + user.empid + "</td>" +
                            "<td>" + user.username + "</td>" +
                            "<td>" + user.fname + "</td>" +
                            "<td>" + user.lname + "</td>" +
                            "<td>" + user.department + "</td>" +
                            "</tr>";
                        tbody.innerHTML += row;
                    }

                    wrapper.style.display = "block";

                },
                error: function (e) {
                    alert("This code will only execute if javascript is unable to access the webservice.");
                }
            });
        }

        function GetUsers() {
            var webMethod = "ProjectServices.asmx/GetUsers"
            var parameters = "{}";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    var users = msg.d;
                    var wrapper = document.getElementById("getUsersTableWrapper");
                    var tbody = document.getElementById("getUsersTableBody");
                    tbody.innerHTML = "";

                    if (users.length === 0) {
                        alert("You are not an admin or no users are currently clocked in.");
                        $("#getUsersTableWrapper").hide();
                        return;
                    }

                    for (var i = 0; i < users.length; i++) {
                        var user = users[i];
                        var row = "<tr>" +
                            "<td>" + user.empid + "</td>" +
                            "<td>" + user.username + "</td>" +
                            "<td>" + user.fname + "</td>" +
                            "<td>" + user.lname + "</td>" +
                            "<td>" + user.department + "</td>" +
                            "</tr>";
                        tbody.innerHTML += row;
                    }

                    wrapper.style.display = "block";

                },
                error: function (e) {
                    alert("This code will only execute if javascript is unable to access the webservice.")
                }
            })
        }

        function AddUser() {
            var uid = $("#addUid").val().trim();
            var pass = $("#addPass").val().trim();
            var fname = $("#addFname").val().trim();
            var lname = $("#addLname").val().trim();
            var dept = $("#addDept").val().trim();
            var webMethod = "ProjectServices.asmx/AddUser"
            var parameters = JSON.stringify({
                uid: encodeURIComponent(uid),
                pass: encodeURIComponent(pass),
                fname: encodeURIComponent(fname),
                lname: encodeURIComponent(lname),
                dept: encodeURIComponent(dept)
            })


            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response.d === true) {
                        alert("User added successfully!");
                        $("#addUsersWrapper").hide();
                        $("#addUid, #addPass, #addFname, #addLname, #addDept").val("");
                    } else {
                        alert("Failed to add user.");
                    }
                },
                error: function (e) {
                    alert("An error occurred while adding the user.");
                }
            });
        }

        function RemoveUser() {
            var uid = $("#removeUid").val().trim();

            if (uid === "") {
                alert("Please enter a username to remove.");
                return;
            }

            var webMethod = "ProjectServices.asmx/RemoveUser";
            var parameters = JSON.stringify({
                username: encodeURIComponent(uid)
            });

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response.d === true) {
                        alert("User removed successfully!");
                        $("#removeUid").val("");
                    } else {
                        alert("Failed to remove user. Make sure the username exists.");
                    }
                },
                error: function () {
                    alert("An error occurred while removing the user.");
                }
            });
        }

        function UpdateUser() {
            var empid = $("#updateEmpId").val().trim();
            var userid = $("#updateUid").val().trim();
            var pass = $("#updatePass").val().trim();
            var fname = $("#updateFname").val().trim();
            var lname = $("#updateLname").val().trim();
            var dept = $("#updateDept").val().trim();

            var webMethod = "ProjectServices.asmx/UpdateUser";
            var parameters = JSON.stringify({
                empid: encodeURIComponent(empid),
                userid: encodeURIComponent(userid),
                pass: encodeURIComponent(pass),
                fname: encodeURIComponent(fname),
                lname: encodeURIComponent(lname),
                dept: encodeURIComponent(dept)
            });

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response.d === true) {
                        alert("User updated successfully!");
                        $("#updateEmpId, #updateUid, #updatePass, #updateFname, #updateLname, #updateDept").val("");
                    } else {
                        alert("Failed to update user. Please check the Employee ID and try again.");
                    }
                },
                error: function () {
                    alert("An error occurred while updating the user. Please make sure every value is filled.");
                }
            });
        }

  


		function SubmitEmojiFeedback(score) {
            var qid = "";
            var empid = "";
            var dept = "";
            var cat = "Stress";
            var feedback = "";

			var webMethod = "ProjectServices.asmx/SubmitFeedback";
			var parameters = JSON.stringify({
				qid: encodeURIComponent(qid),
                empid: encodeURIComponent(empid),
                dept: encodeURIComponent(dept),
                cat: encodeURIComponent(cat),
                score: encodeURIComponent(score),
                feedback: encodeURIComponent(feedback)
			})

            var qid = "";
            var empid = "";
            var dept = "";
            var cat = "Stress";
            var feedback = "";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        alert("Feedback Recieved. Thank you!");
                    } else {
                        alert("Feedback submission failed.");
                    }
                },
                error: function (e) {
                    alert("Could not submit feedback due to server error.");
				}
            });
        }

        function submitNewQuestion() {
            var cat = $("#questionCategory").val().trim();
            var text = $("#questionText").val().trim();
            var active = $("#questionActive").val();

            if (!cat || !text) {
                alert("Please fill in both category and question text.");
                return;
            }

            var webMethod = "ProjectServices.asmx/AddQuestion";
            var parameters = JSON.stringify({
                cat: encodeURIComponent(cat),
                text: encodeURIComponent(text),
                active: encodeURIComponent(active)
            });

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        alert("Question added successfully!");
                        $("#addQuestionWrapper").hide();
                    } else {
                        alert("Failed to add question.");
                    }
                },
                error: function () {
                    alert("Error submitting question.");
                }
            });
        }

        function getAllQuestions() {
            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/GetAllQuestions",
                data: "{}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    const questions = msg.d;
                    let html = "";
                    questions.forEach(q => {
                        const isActive = q.is_active == 1;
                        html += `<tr>
                            <td>${q.question_id}</td>
                            <td>${q.category}</td>
                            <td>${q.question_text}</td>
                            <td>
                                <button onclick="toggleQuestionStatus(${q.question_id}, ${q.is_active ? 0 : 1})">
                                    ${isActive ? "Deactivate" : "Activate"}
                                </button>
                                <button onclick="removeQuestion(${q.question_id})">Delete</button>
                                <button onclick="openUpdateForm(${q.question_id}, '${q.category}', '${q.question_text}', ${q.is_active})">Edit</button>

                    </td>
                </tr>`;
                    });
                    $("#questionTableBody").html(html);
                    $("#questionTableWrapper").show();
                },
                error: function () {
                    alert("Failed to retrieve questions.");
                }
            });
        }

        function removeQuestion(questionId) {
            if (!confirm("Are you sure you want to delete this question?")) return;

            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/RemoveQuestion",
                data: JSON.stringify({ qid: questionId.toString() }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        getAllQuestions();
                    } else {
                        alert("Failed to delete question.");
                    }
                },
                error: function () {
                    alert("Error deleting question.");
                }
            });
        }

        function toggleQuestionStatus(questionId, newStatus) {
            const method = newStatus === 1 ? "TurnOnQuestion" : "TurnOffQuestion";
            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/" + method,
                data: JSON.stringify({ qid: questionId.toString() }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        getAllQuestions();
                    } else {
                        alert("Failed to update question status.");
                    }
                },
                error: function () {
                    alert("Error toggling question status.");
                }
            });
        }

        function openUpdateForm(id, category, text, active) {
            $("#updateQuestionId").val(id);
            $("#updateQuestionCategory").val(decodeURIComponent(category));
            $("#updateQuestionText").val(decodeURIComponent(text));
            $("#updateQuestionActive").val(active);
            $("#updateQuestionWrapper").show();
        }

        function submitUpdatedQuestion() {
            var qid = $("#updateQuestionId").val();
            var cat = $("#updateQuestionCategory").val().trim();
            var text = $("#updateQuestionText").val().trim();
            var active = $("#updateQuestionActive").val();

            if (!cat || !text) {
                alert("Please fill in both category and question text.");
                return;
            }

            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/UpdateQuestion",
                data: JSON.stringify({
                    qid: encodeURIComponent(qid),
                    cat: encodeURIComponent(cat),
                    text: encodeURIComponent(text),
                    active: encodeURIComponent(active)
                }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        alert("Question updated successfully.");
                        $("#updateQuestionWrapper").hide();
                        getAllQuestions();
                    } else {
                        alert("Failed to update question.");
                    }
                },
                error: function () {
                    alert("Error updating question.");
                }
            });
        }

        // ✅ Admin check: show admin tools if user is admin
        $.ajax({
            type: "POST",
            url: "ProjectServices.asmx/AdminCheck",
            data: "{}",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (msg) {
                if (msg.d === true) {
                    $("#adminTools").show();
                }
            },
            error: function () {
                console.error("Failed to check admin login.");
            }
        });


       document.addEventListener("DOMContentLoaded", function () {

    // ✅ Admin check: show admin tools if user is admin
    $.ajax({
        type: "POST",
        url:  "ProjectServices.asmx/AdminCheck",
        data: "{}",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function (msg) {
            if (msg.d === true) {
                $("#adminTools").show();
            }
        },
        error: function () {
            console.error("Failed to check admin login.");
        }
    });

  
    document.querySelectorAll('.score-btn').forEach(button => {
        button.addEventListener('click', function () {
            const score = this.getAttribute('data-score');
            SubmitEmojiFeedback(score);
        });
    });

   
    document.getElementById("closeModal").addEventListener("click", function () {
        document.getElementById("emojiFeedbackModal").style.display = "none";
    });

    document.getElementById("closeAnonModal").addEventListener("click", function () {
        document.getElementById("submitAnonymousFeedback").style.display = "none";
    });

    document.getElementById("closeClockedInUsersModal").addEventListener("click", function () {
        document.getElementById("userTableWrapper").style.display = "none";
    });

    document.getElementById("closeGetUsersModal").addEventListener("click", function () {
        document.getElementById("getUsersTableWrapper").style.display = "none";
    });

    document.getElementById("closeAddUsersModal").addEventListener("click", function () {
        document.getElementById("addUsersWrapper").style.display = "none";
    });

    document.getElementById("closeRemoveUsersModal").addEventListener("click", function () {
        document.getElementById("removeUsersWrapper").style.display = "none";
    });

    document.getElementById("closeUpdateUsersModal").addEventListener("click", function () {
        document.getElementById("updateUsersWrapper").style.display = "none";
    });
});


		function openAnonFeedback() {
			document.getElementById("submitAnonymousFeedback").style.display = "block";
        }

        function openAddUsers() {
            document.getElementById("addUsersWrapper").style.display = "block";
        }

        function openRemoveUsers() {
            document.getElementById("removeUsersWrapper").style.display = "block";
        }

        function openUpdateUsers() {
            document.getElementById("updateUsersWrapper").style.display = "block";
        }

        function showQuestions() {
            document.getElementById("questionTableWrapper").style.display = "block";
            getAllQuestions();
        }

        function openAddQuestion() {
            document.getElementById("addQuestionWrapper").style.display = "block";
        }

        function submitAnonFeedback() {
            var feedback = document.getElementById("feedbackText").value.trim();

            if (!feedback) {
                alert("Please enter your feedback before submitting.");
                return;
            }

            var webMethod = "ProjectServices.asmx/SubmitFeedback";
            var parameters = JSON.stringify({
                qid: "",
                empid: "",
                dept: "",
                cat: "Anonymous",
                score: "",
                feedback: encodeURIComponent(feedback)
            });

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        alert("Anonymous feedback submitted. Thank you!");
                        document.getElementById("feedbackText").value = "";
                        document.getElementById("submitAnonymousFeedback").style.display = "none";
                    } else {
                        alert("Anonymous feedback submission failed.");
                    }
                },
                error: function () {
                    alert("Server error while submitting feedback.");
                }
            });
        }
	</script>
	
	<style>
        * {
            font-family: 'Helvetica Neue LT Std';
            font-size: 16px;
        }

        button {
            background-color: #555555;
            font-family: 'Helvetica Neue LT Std';
            border: none;
            color: white;
            padding: 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border-radius: 4px;
            letter-spacing: 1px;
            transition-duration: 0.1s;
        }

        button:hover {
            background-color: white;
            color: #555555;
            border: 1px solid #555555;
        }
	</style>

</head >
<body>
    <button id="logOffBtn" onclick="LogOff();">Log Off</button>
    <button id="clockInBtn" onclick="ClockIn();">Clock In</button>
    <button id="clockOutBtn" onclick="ClockOut();" style="display: none;">Clock Out</button>
    <p id="clockedinconfirm" style="display:none;">You are clocked in!</p>




    <div id="emojiFeedbackModal" class="modal" style="display: none">
        <div class="modal-content">
            <button class="close" id="closeModal" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h2>Rate Your Shift</h2>

            <div id="scoreButtons">
                <button class="score-btn" data-score="0" id="scorebutton1" style="background-color: #0000FF;">😀</button>
                <button class="score-btn" data-score="3" id="scorebutton2" style="background-color: #00FF00;">😐</button>
                <button class="score-btn" data-score="5" id="scorebutton3" style="background-color: #808080;">🙁</button>
                <button class="score-btn" data-score="8" id="scorebutton4" style="background-color: #FFFF00;">☹️</button>
                <button class="score-btn" data-score="10" id="scorebutton5" style="background-color: #FF0000; ">😭</button>
            </div>
            <div id="feedbackSavedMsg" style="color: green; margin-top: 10px; display: none;">
                Feedback saved!
            </div>
        </div>
    </div>

    <button onclick="openAnonFeedback()">Submit Anonymous Feedback</button>

    <div id="submitAnonymousFeedback" class="modal" style="display: none;">
        <div class="modal-content">
            <button class="close" id="closeAnonModal" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h2>Anonymous Feedback</h2>

            <div id="anonymousFeedback">
                <textarea id="feedbackText" placeholder="Write your feedback here!"></textarea>
                <button onclick="submitAnonFeedback()">Submit</button>
            </div>
        </div>
    </div>

    <div id="adminTools" style="display: none;">
        <h1 style="font-size: 20px; text-decoration: underline;">Admin Tools</h1>

        <h1 style="font-size: 16px;">General</h1>
        <button id="getClockedInUsersBtn" onclick="GetClockedInUsers();">Get Clocked In Users</button>
        <button id="adminCheck" onclick="AdminCheck()">Admin Check</button>


        <div id="userTableWrapper" style="display: none;">
            <button class="close" id="closeClockedInUsersModal" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>Clocked In Users</h3>
            <table id="userTable" border="1">
                <thead>
                    <tr>
                        <th>EmpID</th>
                        <th>Username</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Department</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                </tbody>
            </table>
        </div>


        <h1 style="font-size: 16px;">User Management</h1>
        <button id="getUsers" onclick="GetUsers();">Get Users</button>
        <button id="addUsers" onclick="openAddUsers();">Add Users</button>
        <button id="removeUsers" onclick="openRemoveUsers();">Remove Users</button>
        <button id="editUsers" onclick="openUpdateUsers();">Update Users</button>

        <h1 style="font-size: 16px;">Question Management</h1>
        <button id="addQuestion" onclick="openAddQuestion()">Add New Question</button>
        <button id="showQuestion" onclick="showQuestions()">Show Questions</button>


    </div>

    <div id="getUsersTableWrapper" class="modal" style="display: none;">
        <p></p>
        <button class="close" id="closeGetUsersModal" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
        <h3>Users List</h3>
        <table id="userTable" border="1">
            <thead>
                <tr>
                    <th>EmpID</th>
                    <th>Username</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Department</th>
                </tr>
            </thead>
            <tbody id="getUsersTableBody">
            </tbody>
        </table>
    </div>

    <div id="addUsersWrapper" class="container" style="display: none;">
        <p></p>
        <button class="close" id="closeAddUsersModal" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
        <h3>Add User Info</h3>
        <label for="uid"><b>Username</b></label>
        <input type="text" id="addUid" placeholder="Enter Username" name="username" required />
        <p></p>
        <label for="pass"><b>Password</b></label>
        <input type="text" id="addPass" placeholder="Enter Password" name="pass" required />
        <p></p>

        <button onclick="submitUpdatedQuestion()">Update Question</button>
        <button onclick="$('#updateQuestionWrapper').hide()">Cancel</button>
    </div>

</body>
</html >