<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title></title>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	
	<script type="text/javascript">
		function TestButtonHandler() {
			var webMethod = "ProjectServices.asmx/TestConnection";
			var parameters = "{}";

	
			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
					alert(responseFromServer);
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
		}

        function AdminCheck() {
            var webMethod = "ProjectServices.asmx/AdminCheck"
            var parameters = ""

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        console.log("User is logged in as Admin.");
                        alert("User is logged on as Admin.")
                    }
                    else alert("User does not have Admin privileges.");
                },
                error: function (e) {
                    alert("Unable to check admin status.")
                }
            });
        }


		function LogOff() {

			var webMethod = "ProjectServices.asmx/LogOff"
			var parameters = "{}";

			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
					if (responseFromServer == true) {
						window.location.href = "index.html";
					}
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
		}


        function ClockIn() {

			var webMethod = "ProjectServices.asmx/ClockIn"
			var parameters = "{}";

			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
                    if (responseFromServer == true) {
						document.getElementById("clockInBtn").style.display = "none";
				        document.getElementById("logOffBtn").style.display = "none";
                        document.getElementById("clockOutBtn").style.display = "inline";
                        alert("You are clocked in.")
					}
					else {
						alert("Unable to clock in")
					}
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
        }

        function ClockOut() {

			var webMethod = "ProjectServices.asmx/ClockOut"
			var parameters = "";

			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
                    if (responseFromServer == true) {
						document.getElementById("clockInBtn").style.display = "inline";
				        document.getElementById("logOffBtn").style.display = "inline";
                        document.getElementById("clockOutBtn").style.display = "none";
						alert("You have clocked out, please leave an Emoji, or some feedback to let us know how your shift went.")
						document.getElementById("emojiFeedbackModal").style.display = "block";
					}
					else {
						alert("Unable to Clock out")
					}
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
		}

        function GetClockedInUsers() {

            var webMethod = "ProjectServices.asmx/GetClockedInUsers"
            var parameters = "{}";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    var users = msg.d;
                    var wrapper = document.getElementById("userTableWrapper");
                    var tbody = document.getElementById("userTableBody");
                    tbody.innerHTML = "";

                    if (users.length === 0) {
                        alert("You are not an admin or no users are currently clocked in.");
                        $("#userTableWrapper").hide();
                        return;
                    }

                    for (var i = 0; i < users.length; i++) {
                        var user = users[i];
                        var row = "<tr>" +
                            "<td>" + user.empid + "</td>" +
                            "<td>" + user.username + "</td>" +
                            "<td>" + user.fname + "</td>" +
                            "<td>" + user.lname + "</td>" +
                            "<td>" + user.department + "</td>" +
                            "</tr>";
                        tbody.innerHTML += row;
                    }

                    wrapper.style.display = "block";

                },
                error: function (e) {
                    alert("This code will only execute if javascript is unable to access the webservice.");
                }
            });
        }

        function GetUsers() {
            var webMethod = "ProjectServices.asmx/GetUsers"
            var parameters = "{}";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    var users = msg.d;
                    var wrapper = document.getElementById("getUsersTableWrapper");
                    var tbody = document.getElementById("getUsersTableBody");
                    tbody.innerHTML = "";

                    if (users.length === 0) {
                        alert("You are not an admin or no users are currently clocked in.");
                        $("#getUsersTableWrapper").hide();
                        return;
                    }

                    for (var i = 0; i < users.length; i++) {
                        var user = users[i];
                        var row = "<tr>" +
                            "<td>" + user.empid + "</td>" +
                            "<td>" + user.username + "</td>" +
                            "<td>" + user.fname + "</td>" +
                            "<td>" + user.lname + "</td>" +
                            "<td>" + user.department + "</td>" +
                            "</tr>";
                        tbody.innerHTML += row;
                    }

                    wrapper.style.display = "block";

                },
                error: function (e) {
                    alert("This code will only execute if javascript is unable to access the webservice.")
                }
            })
        }

        function AddUser() {
            var uid = $("#addUid").val().trim();
            var pass = $("#addPass").val().trim();
            var fname = $("#addFname").val().trim();
            var lname = $("#addLname").val().trim();
            var dept = $("#addDept").val().trim();
            var webMethod = "ProjectServices.asmx/AddUser"
            var parameters = JSON.stringify({
                uid: encodeURIComponent(uid),
                pass: encodeURIComponent(pass),
                fname: encodeURIComponent(fname),
                lname: encodeURIComponent(lname),
                dept: encodeURIComponent(dept)
            })


            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response.d === true) {
                        alert("User added successfully!");
                        $("#addUsersWrapper").hide();
                        $("#addUid, #addPass, #addFname, #addLname, #addDept").val("");
                    } else {
                        alert("Failed to add user.");
                    }
                },
                error: function (e) {
                    alert("An error occurred while adding the user.");
                }
            });
        }

        function RemoveUser() {
            var uid = $("#removeUid").val().trim();

            if (uid === "") {
                alert("Please enter a username to remove.");
                return;
            }

            var webMethod = "ProjectServices.asmx/RemoveUser";
            var parameters = JSON.stringify({
                username: encodeURIComponent(uid)
            });

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response.d === true) {
                        alert("User removed successfully!");
                        $("#removeUid").val("");
                    } else {
                        alert("Failed to remove user. Make sure the username exists.");
                    }
                },
                error: function () {
                    alert("An error occurred while removing the user.");
                }
            });
        }

        function UpdateUser() {
            var empid = $("#updateEmpId").val().trim();
            var userid = $("#updateUid").val().trim();
            var pass = $("#updatePass").val().trim();
            var fname = $("#updateFname").val().trim();
            var lname = $("#updateLname").val().trim();
            var dept = $("#updateDept").val().trim();

            var webMethod = "ProjectServices.asmx/UpdateUser";
            var parameters = JSON.stringify({
                empid: encodeURIComponent(empid),
                userid: encodeURIComponent(userid),
                pass: encodeURIComponent(pass),
                fname: encodeURIComponent(fname),
                lname: encodeURIComponent(lname),
                dept: encodeURIComponent(dept)
            });

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response.d === true) {
                        alert("User updated successfully!");
                        $("#updateEmpId, #updateUid, #updatePass, #updateFname, #updateLname, #updateDept").val("");
                    } else {
                        alert("Failed to update user. Please check the Employee ID and try again.");
                    }
                },
                error: function () {
                    alert("An error occurred while updating the user. Please make sure every value is filled.");
                }
            });
        }

  


		function SubmitEmojiFeedback(score) {
            var qid = "";
            var empid = "";
            var dept = "";
            var cat = "Stress";
            var feedback = "";

			var webMethod = "ProjectServices.asmx/SubmitFeedback";
			var parameters = JSON.stringify({
				qid: encodeURIComponent(qid),
                empid: encodeURIComponent(empid),
                dept: encodeURIComponent(dept),
                cat: encodeURIComponent(cat),
                score: encodeURIComponent(score),
                feedback: encodeURIComponent(feedback)
			})

            var qid = "";
            var empid = "";
            var dept = "";
            var cat = "Stress";
            var feedback = "";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        alert("Feedback Recieved. Thank you!");
                    } else {
                        alert("Feedback submission failed.");
                    }
                },
                error: function (e) {
                    alert("Could not submit feedback due to server error.");
				}
            });
        }

        function submitNewQuestion() {
            var cat = $("#questionCategory").val().trim();
            var text = $("#questionText").val().trim();
            var active = $("#questionActive").val();

            if (!cat || !text) {
                alert("Please fill in both category and question text.");
                return;
            }

            var webMethod = "ProjectServices.asmx/AddQuestion";
            var parameters = JSON.stringify({
                cat: encodeURIComponent(cat),
                text: encodeURIComponent(text),
                active: encodeURIComponent(active)
            });

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        alert("Question added successfully!");
                        $("#addQuestionWrapper").hide();
                    } else {
                        alert("Failed to add question.");
                    }
                },
                error: function () {
                    alert("Error submitting question.");
                }
            });
        }

        function getAllQuestions() {
            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/GetAllQuestions",
                data: "{}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    const questions = msg.d;
                    let html = "";
                    questions.forEach(q => {
                        const isActive = q.is_active == 1;
                        html += `<tr>
                            <td>${q.question_id}</td>
                            <td>${q.category}</td>
                            <td>${q.question_text}</td>
                            <td>
                                <button onclick="toggleQuestionStatus(${q.question_id}, ${q.is_active ? 0 : 1})">
                                    ${isActive ? "Deactivate" : "Activate"}
                                </button>
                                <button onclick="removeQuestion(${q.question_id})">Delete</button>
                                <button onclick="openUpdateForm(${q.question_id}, '${q.category}', '${q.question_text}', ${q.is_active})">Edit</button>

                    </td>
                </tr>`;
                    });
                    $("#questionTableBody").html(html);
                    $("#questionTableWrapper").show();
                },
                error: function () {
                    alert("Failed to retrieve questions.");
                }
            });
        }

        function removeQuestion(questionId) {
            if (!confirm("Are you sure you want to delete this question?")) return;

            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/RemoveQuestion",
                data: JSON.stringify({ qid: questionId.toString() }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        getAllQuestions();
                    } else {
                        alert("Failed to delete question.");
                    }
                },
                error: function () {
                    alert("Error deleting question.");
                }
            });
        }

        function toggleQuestionStatus(questionId, newStatus) {
            const method = newStatus === 1 ? "TurnOnQuestion" : "TurnOffQuestion";
            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/" + method,
                data: JSON.stringify({ qid: questionId.toString() }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        getAllQuestions();
                    } else {
                        alert("Failed to update question status.");
                    }
                },
                error: function () {
                    alert("Error toggling question status.");
                }
            });
        }

        function openUpdateForm(id, category, text, active) {
            $("#updateQuestionId").val(id);
            $("#updateQuestionCategory").val(decodeURIComponent(category));
            $("#updateQuestionText").val(decodeURIComponent(text));
            $("#updateQuestionActive").val(active);
            $("#updateQuestionWrapper").show();
        }

        function submitUpdatedQuestion() {
            var qid = $("#updateQuestionId").val();
            var cat = $("#updateQuestionCategory").val().trim();
            var text = $("#updateQuestionText").val().trim();
            var active = $("#updateQuestionActive").val();

            if (!cat || !text) {
                alert("Please fill in both category and question text.");
                return;
            }

            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/UpdateQuestion",
                data: JSON.stringify({
                    qid: encodeURIComponent(qid),
                    cat: encodeURIComponent(cat),
                    text: encodeURIComponent(text),
                    active: encodeURIComponent(active)
                }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        alert("Question updated successfully.");
                        $("#updateQuestionWrapper").hide();
                        getAllQuestions();
                    } else {
                        alert("Failed to update question.");
                    }
                },
                error: function () {
                    alert("Error updating question.");
                }
            });
        }


        // ✅ Admin check: show admin tools if user is admin
        $.ajax({
            type: "POST",
            url: "ProjectServices.asmx/AdminCheck",
            data: "{}",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (msg) {
                if (msg.d === true) {
                    $("#adminTools").show();
                }
            },
            error: function () {
                console.error("Failed to check admin login.");
            }
        });


        function getNews() {
            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/GetAllNews", 
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    let newsArray = response.d; 
                    let tableBody = $("#getNewsTableBody");
                    tableBody.empty();

                    for (let i = 0; i < newsArray.length; i++) {

                        let timestamp = parseInt(newsArray[i].posted_at.match(/\d+/)[0], 10);
                        let formattedDate = new Date(timestamp).toLocaleString();
                        
                        let row = `<tr>
                    <td>${newsArray[i].news_id}</td>
                    <td>${newsArray[i].title}</td>
                    <td>${newsArray[i].content}</td>
                    <td>${formattedDate}</td>
                </tr>`;
                        tableBody.append(row);
                    }

                    $("#getNewsTableWrapper").show();
                },
                error: function (xhr, status, error) {
                    console.error("Error getting news:", error);
                    alert("Failed to fetch news data.");
                }
            });
        }


        function turnOnNews() {
            var nid = document.getElementById('newsIdInput').value.trim();
            if (nid === "") {
                alert("Please enter a News ID.");
                return;
            }
            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/TurnOnNews",
                data: JSON.stringify({ nid: encodeURIComponent(nid) }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response.d === true) {
                        alert("News Post is now active!")
                    } else {
                        alert("Error activating News Post.")
                    }
                },
                error: function () {
                    document.getElementById('turnOnNewsMessage').innerText = "An error occurred while trying to activate the news post.";
                }
            });
        }

        function turnOffNews() {
            var nid = document.getElementById('turnOffNewsId').value.trim();
            if (nid === "") {
                alert("Please enter a News ID.");
                return;
            }

            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/TurnOffNews",
                data: JSON.stringify({ nid: encodeURIComponent(nid) }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response.d === true) {
                        alert("News Post turned off successfully!");
                        document.getElementById('turnOffNewsId').value = "";
                    } else {
                        alert("Failed to turn off News Post.");
                    }
                },
                error: function () {
                    alert("An error occurred while trying to turn off the news post.");
                }
            });
        }

        function addNews() {
            var title = document.getElementById('newsTitle').value.trim();
            var content = document.getElementById('newsContent').value.trim();

            if (title === "" || content === "") {
                alert("Please enter both a title and content.");
                return;
            }

            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/AddNews",
                data: JSON.stringify({
                    title: title,
                    content: content,
                }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response.d === true) {
                        alert("News Post added successfully!");
                        document.getElementById('newsTitle').value = "";
                        document.getElementById('newsContent').value = "";
                    } else {
                        alert("Failed to add News Post.");
                    }
                },
                error: function () {
                    alert("An error occurred while adding the News Post.");
                }
            });
        }


        function RemoveNewsById() {
            var nid = $("#removeNewsId").val().trim();
            if (!nid) {
                alert("Please enter a News ID to remove.");
                return;
            }

            RemoveNews(nid);
        }


        function RemoveNews(nid) {
            var webMethod = "ProjectServices.asmx/RemoveNews";
            var parameters = JSON.stringify({ nid: nid });

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response.d === true) {
                        alert("News removed successfully!");
                    } else {
                        alert("Failed to remove news.");
                    }
                },
                error: function () {
                    alert("Error calling RemoveNews web method.");
                }
            });
        }

        function UpdateNewsById() {
            var nid = $("#updateNewsId").val().trim();
            var newTitle = $("#updateNewsTitle").val().trim();
            var newContent = $("#updateNewsContent").val().trim();

            if (!nid) {
                alert("Please enter the News ID to update.");
                return;
            }

            var webMethod = "ProjectServices.asmx/UpdateNews";
            var parameters = JSON.stringify({
                nid: nid,
                title: newTitle,
                content: newContent
            });

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    console.log("Response:", response);
                    if (response.d === true) {
                        alert("News updated successfully!");
                        $("#updateNewsId, #updateNewsTitle, #updateNewsContent").val("");
                        $("#updateNewsWrapper").hide();
                    } else {
                        alert("Failed to update news.");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("AJAX error:", status, error);
                    alert("An error occurred while updating the news.");
                }
            });
        }

        function WeeklyHours() {
            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/WeeklyHours",
                data: "{}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    let hours = msg.d;
                    $("#weeklyHoursDisplay").html(`You've worked ${hours.toFixed(2)} hours this week.`);
                },
                error: function () {
                    alert("Failed to retrieve weekly hours.");
                }
            });
        }

        function loadUserFeedback() {
            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/GetUserFeedback",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    const feedbackArray = response.d;
                    let html = "<h3>Your Feedback</h3>";

                    if (feedbackArray.length === 0) {
                        html += "<p>No feedback found.</p>";
                    } else {
                        html += "<table border='1' style='border-collapse: collapse;'>";
                        html += "<tr><th>ID</th><th>Category</th><th>Score</th><th>Feedback</th><th>Time</th><th>Resolved</th></tr>";

                        feedbackArray.forEach(fb => {
                            html += "<tr>";
                            html += `<td>${fb.feedback_id}</td>`;
                            html += `<td>${fb.category}</td>`;
                            html += `<td>${fb.score ?? "N/A"}</td>`;
                            html += `<td>${fb.feedback_text}</td>`;
                            html += `<td>${new Date(fb.feedback_time).toLocaleString()}</td>`;
                            html += `<td>${fb.is_resolved ? "✅" : "❌"}</td>`;
                            html += "</tr>";
                        });

                        html += "</table>";
                    }

                    document.getElementById("userFeedbackContainer").innerHTML = html;
                },
                error: function (xhr, status, error) {
                    console.error("Error loading feedback:", error);
                    document.getElementById("userFeedbackContainer").innerHTML =
                        "<p style='color: red;'>Failed to load feedback. Are you logged in?</p>";
                }
            });
        }


        function GetAverageStressScore() {
            var dept = $("#avgStressDept").val().trim();

            if (!dept) {
                alert("Please enter a department name.");
                return;
            }

            var webMethod = "ProjectServices.asmx/GetAvgStressScore";
            var parameters = JSON.stringify({ dept: dept });

            console.log("Requesting average stress score for department:", dept);

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    console.log("Response:", response);
                    alert("Average Stress Score for " + dept + " (this week): " + response.d.toFixed(2));
                    $("#avgStressDept").val(""); 
                },
                error: function (xhr, status, error) {
                    console.error("Error:", status, error);
                    alert("An error occurred while retrieving the average stress score.");
                }
            });
        }


        function GetDeptStressAverages() {
            var webMethod = "ProjectServices.asmx/GetDeptStressAveragesForCurrentWeek";

            console.log("Requesting average stress scores for all departments this week...");

            $.ajax({
                type: "POST",
                url: webMethod,
                data: "{}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    console.log("Response:", response);

                    var stressData = response.d;

                    if (!stressData || stressData.length === 0) {
                        alert("No stress data found for this week.");
                        return;
                    }

                    var outputHtml = "<table border='1' cellpadding='5'><tr><th>Department</th><th>Average Stress Score</th></tr>";
                    for (var i = 0; i < stressData.length; i++) {
                        outputHtml += "<tr>" +
                            "<td>" + (stressData[i].department || "N/A") + "</td>" +
                            "<td>" + (stressData[i].stress !== null ? stressData[i].stress.toFixed(2) : "No Data") + "</td>" +
                            "</tr>";
                    }
                    outputHtml += "</table>";

                    $("#deptStressResults").html(outputHtml);
                },
                error: function (xhr, status, error) {
                    console.error("Error:", status, error);
                    alert("An error occurred while retrieving department stress scores.");
                }
            });
        }

        function GetDeptStressAveragesByDate() {
            var webMethod = "ProjectServices.asmx/GetDeptStressAveragesForDateRange";

            var startDate = $("#stressStartDate").val();
            var endDate = $("#stressEndDate").val();

            if (!startDate || !endDate) {
                alert("Please select both start and end dates.");
                return;
            }

            console.log("Requesting average stress scores from " + startDate + " to " + endDate);

            $.ajax({
                type: "POST",
                url: webMethod,
                data: JSON.stringify({ startDate: startDate, endDate: endDate }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    console.log("Response:", response);

                    var stressData = response.d;

                    if (!stressData || stressData.length === 0) {
                        $("#deptStressDateResults").html("<p>No data found for the selected range.</p>");
                        return;
                    }

                    var outputHtml = "<table border='1' cellpadding='5'><tr><th>Department</th><th>Average Stress Score</th></tr>";
                    for (var i = 0; i < stressData.length; i++) {
                        outputHtml += "<tr>" +
                            "<td>" + (stressData[i].department || "N/A") + "</td>" +
                            "<td>" + (stressData[i].stress !== null ? stressData[i].stress.toFixed(2) : "No Data") + "</td>" +
                            "</tr>";
                    }
                    outputHtml += "</table>";

                    $("#deptStressDateResults").html(outputHtml);
                },
                error: function (xhr, status, error) {
                    console.error("Error:", status, error);
                    alert("An error occurred while retrieving department stress scores for the selected date range.");
                }
            });
        }







        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll('.score-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const score = this.getAttribute('data-score');
                    SubmitEmojiFeedback(score);
                });
            });

            document.getElementById("closeModal").addEventListener("click", function () {
                document.getElementById("emojiFeedbackModal").style.display = "none";
            });

            document.getElementById("closeAnonModal").addEventListener("click", function () {
                document.getElementById("submitAnonymousFeedback").style.display = "none";
            });

            document.getElementById("closeClockedInUsersModal").addEventListener("click", function () {
                document.getElementById("userTableWrapper").style.display = "none";
            });

            document.getElementById("closeGetUsersModal").addEventListener("click", function () {
                document.getElementById("getUsersTableWrapper").style.display = "none";
            });

            document.getElementById("closeAddUsersModal").addEventListener("click", function () {
                document.getElementById("addUsersWrapper").style.display = "none";
            });

            document.getElementById("closeRemoveUsersModal").addEventListener("click", function () {
                document.getElementById("removeUsersWrapper").style.display = "none";
            });

            document.getElementById("closeUpdateUsersModal").addEventListener("click", function () {
                document.getElementById("updateUsersWrapper").style.display = "none";
            });
            document.getElementById("closeAddQuestionWrapper").addEventListener("click", function () {
                document.getElementById("addQuestionWrapper").style.display = "none";
            });
            document.getElementById("closeUpdateQuestionWrapper").addEventListener("click", function () {
                document.getElementById("updateQuestionWrapper").style.display = "none";
            });
            document.getElementById("closeQuestionTableWrapper").addEventListener("click", function () {
                document.getElementById("questionTableWrapper").style.display = "none";
            });
            document.getElementById("closeGetNewsModal").addEventListener("click", function () {
                document.getElementById("getNewsTableWrapper").style.display = "none";
            });
            document.getElementById("closeTurnOnNewsWrapper").addEventListener("click", function () {
                document.getElementById("turnOnNewsWrapper").style.display = "none";
            });
            document.getElementById("closeTurnOffNewsWrapper").addEventListener("click", function () {
                document.getElementById("turnOffNewsWrapper").style.display = "none";
            });
            document.getElementById("closeAddNewsWrapper").addEventListener("click", function () {
                document.getElementById("addNewsWrapper").style.display = "none";
            });
            document.getElementById("closeRemoveNewsWrapper").addEventListener("click", function () {
                document.getElementById("removeNewsWrapper").style.display = "none";
            });
            document.getElementById("closeUpdateNewsWrapper").addEventListener("click", function () {
                document.getElementById("updateNewsWrapper").style.display = "none";
            });
            document.getElementById("closeAvgStressWrapper").addEventListener("click", function () {
                document.getElementById("avgStressWrapper").style.display = "none";
            });
            document.getElementById("closeDeptStressWrapper").addEventListener("click", function () {
                document.getElementById("deptStressWrapper").style.display = "none";
            });
            document.getElementById("closeDeptStressDateWrapper").addEventListener("click", function () {
                document.getElementById("deptStressDateWrapper").style.display = "none";
            });
        });











		function openAnonFeedback() {
			document.getElementById("submitAnonymousFeedback").style.display = "block";
        }

        function openAddUsers() {
            document.getElementById("addUsersWrapper").style.display = "block";
        }

        function openRemoveUsers() {
            document.getElementById("removeUsersWrapper").style.display = "block";
        }

        function openUpdateUsers() {
            document.getElementById("updateUsersWrapper").style.display = "block";
        }

        function showQuestions() {
            document.getElementById("questionTableWrapper").style.display = "block";
            getAllQuestions();
        }

        function openAddQuestion() {
            document.getElementById("addQuestionWrapper").style.display = "block";
        }

        function openTurnOnNews() {
            document.getElementById("turnOnNewsWrapper").style.display = "block";
        }
        function openTurnOffNews() {
            document.getElementById("turnOffNewsWrapper").style.display = "block";
        }
        function openAddNews() {
            document.getElementById("addNewsWrapper").style.display = "block";
        }
        function openRemoveNews() {
            document.getElementById("removeNewsWrapper").style.display = "block";
        }
        function openUpdateNews() {
            document.getElementById("updateNewsWrapper").style.display = "block";
        }
        function openGetAvgStressScore() {
            document.getElementById("avgStressWrapper").style.display = "block";
        }
        function openGetDeptStressAveragesForCurrentWeek() {
            document.getElementById("deptStressWrapper").style.display = "block";
        }
        function openGetDeptStressAveragesForDateRange() {
            document.getElementById("deptStressDateWrapper").style.display = "block";
        }


        function submitAnonFeedback() {
            var feedback = document.getElementById("feedbackText").value.trim();

            if (!feedback) {
                alert("Please enter your feedback before submitting.");
                return;
            }

            var webMethod = "ProjectServices.asmx/SubmitFeedback";
            var parameters = JSON.stringify({
                qid: "",
                empid: "",
                dept: "",
                cat: "Anonymous",
                score: "",
                feedback: encodeURIComponent(feedback)
            });

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === true) {
                        alert("Anonymous feedback submitted. Thank you!");
                        document.getElementById("feedbackText").value = "";
                        document.getElementById("submitAnonymousFeedback").style.display = "none";
                    } else {
                        alert("Anonymous feedback submission failed.");
                    }
                },
                error: function () {
                    alert("Server error while submitting feedback.");
                }
            });
            
        }
       
	</script>

	<style>
        * {
            font-family: 'Helvetica Neue LT Std';
            font-size: 16px;
        }

        button {
            background-color: #555555;
            font-family: 'Helvetica Neue LT Std';
            border: none;
            color: white;
            padding: 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border-radius: 4px;
            letter-spacing: 1px;
            transition-duration: 0.1s;
        }

        button:hover {
            background-color: white;
            color: #555555;
            border: 1px solid #555555;
        }
	</style>

</head>




<body>
    <button id="logOffBtn" onclick="LogOff();">Log Off</button>
    <button id="clockInBtn" onclick="ClockIn();">Clock In</button>
    <button id="clockOutBtn" onclick="ClockOut();" style="display: none;">Clock Out</button>
    <button onclick="WeeklyHours()">Check Weekly Hours Worked</button>
    <button onclick="loadUserFeedback()">View My Feedback</button>
    <button onclick="openAnonFeedback()">Submit Anonymous Feedback</button>
    <p id="clockedinconfirm" style="display:none;">You are clocked in!</p>
    <div id="userFeedbackContainer"></div>
    <div id="weeklyHoursDisplay"></div>

    <div id="emojiFeedbackModal" class="modal" style="display: none">
        <div class="modal-content">
            <button class="close" id="closeModal" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h2>Rate Your Shift</h2>

            <div id="scoreButtons">
                <button class="score-btn" data-score="0" id="scorebutton1" style="background-color: #0000FF;">😀</button>
                <button class="score-btn" data-score="3" id="scorebutton2" style="background-color: #00FF00;">😐</button>
                <button class="score-btn" data-score="5" id="scorebutton3" style="background-color: #808080;">🙁</button>
                <button class="score-btn" data-score="8" id="scorebutton4" style="background-color: #FFFF00;">☹️</button>
                <button class="score-btn" data-score="10" id="scorebutton5" style="background-color: #FF0000; ">😭</button>
            </div>
            <div id="feedbackSavedMsg" style="color: green; margin-top: 10px; display: none;">
                Feedback saved!
            </div>
        </div>
    </div>

    

    <div id="submitAnonymousFeedback" class="modal" style="display: none;">
        <div class="modal-content">
            <button class="close" id="closeAnonModal" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h2>Anonymous Feedback</h2>

            <div id="anonymousFeedback">
                <textarea id="feedbackText" placeholder="Write your feedback here!"></textarea>
                <button onclick="submitAnonFeedback()">Submit</button>
            </div>
        </div>
    </div>







    <div id="adminTools" style="display: none;">
        <h1 style="font-size: 20px; text-decoration: underline;">Admin Tools</h1>

        <h1 style="font-size: 16px;">General</h1>
        <button id="getClockedInUsersBtn" onclick="GetClockedInUsers();">Get Clocked In Users</button>
        <button id="adminCheck" onclick="AdminCheck()">Admin Check</button>


        <div id="userTableWrapper" style="display: none;">
            <button class="close" id="closeClockedInUsersModal" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>Clocked In Users</h3>
            <table id="userTable" border="1">
                <thead>
                    <tr>
                        <th>EmpID</th>
                        <th>Username</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Department</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                </tbody>
            </table>
        </div>










        <h1 style="font-size: 16px;">User Management</h1>
        <button id="getUsers" onclick="GetUsers();">Get Users</button>
        <button id="addUsers" onclick="openAddUsers();">Add Users</button>
        <button id="removeUsers" onclick="openRemoveUsers();">Remove Users</button>
        <button id="editUsers" onclick="openUpdateUsers();">Update Users</button>


        <div id="getUsersTableWrapper" class="modal" style="display: none;">
            <p></p>
            <button class="close" id="closeGetUsersModal" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>Users List</h3>
            <table id="userTable" border="1">
                <thead>
                    <tr>
                        <th>EmpID</th>
                        <th>Username</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Department</th>
                    </tr>
                </thead>
                <tbody id="getUsersTableBody">
                </tbody>
            </table>
        </div>

        <div id="addUsersWrapper" class="container" style="display: none;">
            <p></p>
            <button class="close" id="closeAddUsersModal" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>Add User Info</h3>
            <label for="uid"><b>Username</b></label>
            <input type="text" id="addUid" placeholder="Enter Username" name="username" required />
            <p></p>
            <label for="pass"><b>Password</b></label>
            <input type="text" id="addPass" placeholder="Enter Password" name="pass" required />
            <p></p>
            <label for="fname"><b>First Name</b></label>
            <input type="text" id="addFname" placeholder="Enter First Name" name="fname" required />
            <p></p>
            <label for="lname"><b>Last Name</b></label>
            <input type="text" id="addLname" placeholder="Enter Last Name" name="lname" required />
            <p></p>
            <label for="dept"><b>Department</b></label>
            <input type="text" id="addDept" placeholder="Enter Department" name="dept" required />
            <p></p>
            <button id="addUser" onclick="AddUser()">Add User</button>

        </div>

        <div id="removeUsersWrapper" class="container" style="display: none;">
            <p></p>
            <button class="close" id="closeRemoveUsersModal" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>Remove User by Username</h3>
            <label for="uid"><b>Username</b></label>
            <input type="text" id="removeUid" placeholder="Enter Username" name="username" required />
            <p></p>
            <button id="removeUser" onclick="RemoveUser()">Remove User</button>
        </div>

        <div id="updateUsersWrapper" class="container" style="display: none;">
            <p></p>
            <button class="close" id="closeUpdateUsersModal" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>Update User</h3>
            <label for="empid"><b>Employee ID</b></label>
            <input type="text" id="updateEmpId" placeholder="Enter Employee ID" name="empid" required />
            <p></p>
            <label for="uid"><b>Username</b></label>
            <input type="text" id="updateUid" placeholder="Enter Username" name="username" required />
            <p></p>
            <label for="pass"><b>Password</b></label>
            <input type="text" id="updatePass" placeholder="Enter Password" name="pass" required />
            <p></p>
            <label for="fname"><b>First Name</b></label>
            <input type="text" id="updateFname" placeholder="Enter First Name" name="fname" required />
            <p></p>
            <label for="lname"><b>Last Name</b></label>
            <input type="text" id="updateLname" placeholder="Enter Last Name" name="lname" required />
            <p></p>
            <label for="dept"><b>Department</b></label>
            <input type="text" id="updateDept" placeholder="Enter Department" name="dept" required />
            <p></p>
            <button id="updateUser" onclick="UpdateUser()">Update User</button>
        </div>








        <h1 style="font-size: 16px;">Question Management</h1>
        <button id="addQuestion" onclick="openAddQuestion()">Add New Question</button>
        <button id="showQuestion" onclick="showQuestions()">Show Questions</button>


        <div id="addQuestionWrapper" style="display:none;">
            <p></p>
            <button class="close" id="closeAddQuestionWrapper" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>Add Question</h3>
            <input type="text" id="questionCategory" placeholder="Category">
            <textarea id="questionText" placeholder="Question text"></textarea>
            <select id="questionActive">
                <option value="1">Active</option>
                <option value="0">Inactive</option>
            </select>
            <button onclick="submitNewQuestion()">Submit</button>
        </div>

        <div id="questionTableWrapper" style="display: none;">
            <p></p>
            <button class="close" id="closeQuestionTableWrapper" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>All Questions</h3>
            <table border="1">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Category</th>
                        <th>Text</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="questionTableBody"></tbody>
            </table>
        </div>

        <div id="updateQuestionWrapper" style="display:none;">
            <p></p>
            <button class="close" id="closeUpdateQuestionWrapper" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <input type="hidden" id="updateQuestionId" />
            <label>Category:</label><input type="text" id="updateQuestionCategory"><br>
            <label>Question Text:</label><textarea id="updateQuestionText"></textarea><br>
            <label>Active:</label>
            <select id="updateQuestionActive">
                <option value="1">Active</option>
                <option value="0">Inactive</option>
            </select><br>
            <button onclick="submitUpdatedQuestion()">Update Question</button>
            <button onclick="$('#updateQuestionWrapper').hide()">Cancel</button>
        </div>













        <h1 style="font-size: 16px;">News Management</h1>
        <button id="getAllNews" onclick="getNews();">Get News</button>
        <button id="turnOnNews" onclick="openTurnOnNews();">Turn On News</button>
        <button id="turnOffNews" onclick="openTurnOffNews();">Turn Off News</button>
        <button id="addNews" onclick="openAddNews();">Add News</button>
        <button id="removeNews" onclick="openRemoveNews();">Remove News</button>
        <button id="updateNews" onclick="openUpdateNews();">Update News</button>


        <div id="getNewsTableWrapper" class="modal" style="display: none;">
            <p></p>
            <button class="close" id="closeGetNewsModal" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>News List</h3>
            <table id="newsTable" border="1">
                <thead>
                    <tr>
                        <th>News ID</th>
                        <th>Title</th>
                        <th>Content</th>
                        <th>Posted At</th>
                    </tr>
                </thead>
                <tbody id="getNewsTableBody">
                </tbody>
            </table>
        </div>

        <div id="turnOnNewsWrapper" class="modal" style="display:none;">
            <p></p>
            <button class="close" id="closeTurnOnNewsWrapper" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>Turn On News Post</h3>
            <label for="newsIdInput">News ID:</label>
            <input type="text" id="newsIdInput" placeholder="Enter News ID" />
            <p></p>
            <button id="turnOnNews" onclick="turnOnNews();">Turn On News</button>
        </div>

        <div id="turnOffNewsWrapper" class="container" style="display:none;">
            <p></p>
            <button class="close" id="closeTurnOffNewsWrapper" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>Turn Off News Post</h3>
            <label for="turnOffNewsId">News ID:</label>
            <input type="text" id="turnOffNewsId" placeholder="Enter News ID" required />
            <p></p>
            <button id="turnOffNews" onclick="turnOffNews()">Turn Off News</button>
        </div>

        <div id="addNewsWrapper" class="container" style="display:none;">
            <p></p>
            <button class="close" id="closeAddNewsWrapper" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>Add News Post</h3>
            <label for="newsTitle">Title:</label><br />
            <input type="text" id="newsTitle" placeholder="Enter title" required /><br /><br />

            <label for="newsContent">Content:</label><br />
            <textarea id="newsContent" placeholder="Enter news content" rows="4" cols="50" required></textarea><br /><br />
            <p></p>
            <button onclick="addNews()">Add News</button>
        </div>

        <div id="removeNewsWrapper" style="display:none; margin-top: 20px;">
            <p></p>
            <button class="close" id="closeRemoveNewsWrapper" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>Remove News Post</h3>
            <label for="removeNewsId">News ID:</label>
            <input type="text" id="removeNewsId" name="removeNewsId" placeholder="Enter News ID" />
            <p></p>
            <button onclick="RemoveNewsById()">Remove News</button>
        </div>

        <div id="updateNewsWrapper" style="display:none; margin-top: 20px;">
            <p></p>
            <button class="close" id="closeUpdateNewsWrapper" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>Update News Post</h3>
            <label for="updateNewsId">News ID:</label>
            <input type="text" id="updateNewsId" placeholder="Enter News ID" />
            <br />
            <label for="updateNewsTitle">New Title:</label>
            <input type="text" id="updateNewsTitle" placeholder="Enter new title (optional)" />
            <br />
            <label for="updateNewsContent">New Content:</label>
            <textarea id="updateNewsContent" placeholder="Enter new content (optional)"></textarea>
            <br />
            <button onclick="UpdateNewsById()">Update News</button>
        </div>





        <h1 style="font-size: 16px;">Stress Management</h1>
        <button id="getAvgStressScore" onclick="openGetAvgStressScore();">Avg Stress Scores by Dept</button>
        <button id="getDeptStressAveragesForCurrentWeek" onclick="openGetDeptStressAveragesForCurrentWeek();">Weekly Stress Averages by Dept</button>
        <button id="getDeptStressAveragesForDateRange" onclick="openGetDeptStressAveragesForDateRange();">Weekly Stress Averages by Date Range</button>

        <div id="avgStressWrapper" style="display:none; margin-top: 20px;">
            <button class="close" id="closeAvgStressWrapper" style="background-color: #f44336; font-size: 8px; padding: 10px;">X</button>
            <h3>Get Average Stress Score</h3>
            <label for="avgStressDept">Department:</label>
            <input type="text" id="avgStressDept" placeholder="Enter Department" />
            <p></p>
            <button onclick="GetAverageStressScore()">Get Score</button>
        </div>

        <div id="deptStressWrapper" style="display:none; margin-top: 20px;">
            <button class="close" id="closeDeptStressWrapper"
                    style="background-color: #f44336; font-size: 8px; padding: 10px;">
                X
            </button>
            <h3>Average Stress Scores for All Departments (This Week)</h3>
            <button onclick="GetDeptStressAverages()">Load Scores</button>
            <div id="deptStressResults" style="margin-top: 15px;"></div>
        </div>

        <div id="deptStressDateWrapper" style="display:none; margin-top: 20px;">
            <button class="close" id="closeDeptStressDateWrapper"
                    style="background-color: #f44336; font-size: 8px; padding: 10px;">
                X
            </button>
            <h3>Average Stress Scores for All Departments (Custom Date Range)</h3>

            <label for="stressStartDate">Start Date:</label>
            <input type="date" id="stressStartDate">

            <label for="stressEndDate">End Date:</label>
            <input type="date" id="stressEndDate">

            <button onclick="GetDeptStressAveragesByDate()">Load Scores</button>

            <div id="deptStressDateResults" style="margin-top: 15px;"></div>
        </div>

    </div>



</body>
</html >